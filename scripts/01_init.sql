CREATE TABLE IF NOT EXISTS users (
    id UUID PRIMARY KEY,
    balance DOUBLE PRECISION NOT NULL
);

CREATE TABLE IF NOT EXISTS transactions (
    id UUID PRIMARY KEY,
    user_id UUID NOT NULL,
    amount DOUBLE PRECISION NOT NULL,
    created_at TIMESTAMP NOT NULL,
    idempotency_key UUID NOT NULL,
    FOREIGN KEY (user_id) REFERENCES users (id) ON DELETE CASCADE
);

-- Insert sample users
INSERT INTO users (id, balance)
VALUES
  ('123e4567-e89b-12d3-a456-426614174000', 600.00),
  ('123e4567-e89b-12d3-a456-426614174001', 0.00),
  ('123e4567-e89b-12d3-a456-426614174002', 0.00);

-- Insert sample transactions
INSERT INTO transactions (id, user_id, amount, created_at, idempotency_key)
VALUES
  ('223e4567-e89b-12d3-a456-426614174000', '123e4567-e89b-12d3-a456-426614174000', 100.00, '2022-01-01 00:00:00', '323e4567-e89b-12d3-a456-426614174000'),
  ('223e4567-e89b-12d3-a456-426614174001', '123e4567-e89b-12d3-a456-426614174000', 200.00, '2022-01-02 00:00:00', '323e4567-e89b-12d3-a456-426614174001'),
  ('223e4567-e89b-12d3-a456-426614174002', '123e4567-e89b-12d3-a456-426614174000', 300.00, '2022-01-03 00:00:00', '323e4567-e89b-12d3-a456-426614174002');
